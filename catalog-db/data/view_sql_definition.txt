USE `catalog`;

--
-- Dumping data for table `view_sql_definition`
--

LOCK TABLES `view_sql_definition` WRITE;
/*!40000 ALTER TABLE `view_sql_definition` DISABLE KEYS */;
INSERT INTO `view_sql_definition` VALUES ('sql_def_d8bb8724-ff06-4eb3-b9c8-ab77dc5e07ea','View_Test_Definition','viewinfo_fd1eb471-0515-4831-a0aa-c26f1ae492cd','View_Test Definition',1,0,'','',1519709950736,1519709950736,'System','System'),('view_def_67185ab2-7af3-4c08-8e5f-ae70f4d41296','ViewDCF_Daily','view_a5e4c22a-8a79-432f-a74b-a52f8b67a510','SELECT COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC,c.timeEpochMillisUTC,d.timeEpochMillisUTC,f.eventRaisedTimeMillis,g.eventRaisedTimeMillis,h.eventRaisedTimeMillis,i.eventRaisedTimeMillis,j.eventRaisedTimeMillis,UNIX_TIMESTAMP(NOW())) as startTime\n  , COALESCE(a.timeEpochMillisUTC,0) as PageLoadTimeEpochMillisUTC\n  , COALESCE(b.associativeTag,a.associativeTag) as VisitorID \n  , COALESCE(b.channelSessionId,a.channelSessionId) as VisitorBrowserSessionId \n  , COALESCE(b.applicationId,a.applicationId) as ClientID \n  , COALESCE(a.pageURL,\'\') as PageLoadURL\n  , COALESCE(a.pageTitle,\'\') as PageTitle\n  , COALESCE(b.timeEpochMillisUTC,0) as HotleadTimeEpochMillisUTC\n  , COALESCE(b.targetGroupId,\'\') as TargetGroupID\n  , COALESCE(b.ruleId,\'\') as RuleID\n  , COALESCE(c.timeEpochMillisUTC,0) as InviteShownTimeEpochMillisUTC\n  , COALESCE(c.inviteId,\'\') as InviteID\n  , COALESCE(c.inviteType,\'\') as InviteType\n  , COALESCE(d.timeEpochMillisUTC,0) as InviteResponseTimeEpochMillisUTC\n  , COALESCE(d.response,\'\') as InviteResponseID\n  , COALESCE(d.timeEpochMillisUTC,0) as PCFTimeEpochMillisUTC\n  , COALESCE(f.eventRaisedTimeMillis,0) as ChatRequestTimeEpochMillisUTC\n  , COALESCE(f.interactionId,\'\') as InteractionID\n  , COALESCE(g.eventRaisedTimeMillis,0) as ChatStartedTimeEpochMillisUTC\n  , COALESCE(h.eventRaisedTimeMillis,0) as ChatInteractiveTimeEpochMillisUTC\n  , COALESCE(i.queue,\'\') as ChatDisposedQueueID\n  , COALESCE(i.eventRaisedTimeMillis,0) as ChatDisposedTimeEpochMillisUTC\n  , COALESCE(j.eventRaisedTimeMillis,0) as ChatCancelledTimeEpochMillisUTC\n  , COALESCE(j.terminationCode,\'\') as ChatCancelID\n  , COALESCE(j.queue,\'\') as ChatCancelQueueID\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as InteractiveUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as InteractiveUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as InteractiveAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as InteractivePlatformFailure\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as ConnectedUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as ConnectedUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_NON_RESPONSIVE_AUTO_TERMINATED\') THEN 1 ELSE 0 END as ConnectedUserUnreachableAgentEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as ConnectedAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as ConnectedPlatformFailure\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as QueuedUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as QueuedUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_FULL\') THEN 1 ELSE 0 END as QueuedQueueFull\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_TIMEOUT\') THEN 1 ELSE 0 END as QueuedQueueTimeOut\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as QueuedAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as QueuedPlatformFailure \n  , CONCAT(COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC),\':\',COALESCE(b.channelSessionId,a.channelSessionId)) as UniqueRowId \n  FROM\n  (\n      SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextHotLead\n      FROM\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.applicationId\n          , header.associativeTag\n          , header.channelSessionId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n          from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n      ) a\n      LEFT OUTER JOIN\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.applicationId\n          , header.associativeTag\n          , header.channelSessionId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n          from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n      ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n      group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId\n  ) b \n  LEFT OUTER JOIN \n  (\n      SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextPageLoad\n      FROM\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.associativeTag\n          , header.channelSessionId\n          , header.applicationId\n          , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n          , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n          , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n          , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n          FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n      ) a\n      LEFT OUTER JOIN\n      (\n      SELECT header.timeEpochMillisUTC\n      , header.associativeTag\n      , header.channelSessionId\n      , header.applicationId\n      , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n      , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n      , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n      , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n      FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n      ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n      group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL\n  \n  ) a on a.applicationId = b.applicationId and a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and b.timeEpochMillisUTC between a.timeEpochMillisUTC and COALESCE(a.timeEpochMillisUTCNextPageLoad,b.timeEpochMillisUTC)\n  LEFT OUTER JOIN\n  (\n      SELECT header.timeEpochMillisUTC\n      , header.applicationId\n      , header.associativeTag\n      , header.channelSessionId\n      , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteId\n      , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteType\n      from RawIDM where body.typeSpecificBody.body.OnlineInvitationOfferEvent IS NOT NULL\n  ) c on COALESCE(b.applicationId,a.applicationId) = c.applicationId and COALESCE(b.associativeTag,a.associativeTag) = c.associativeTag\n  and COALESCE(b.channelSessionId,a.channelSessionId) = substring_index(c.channelSessionId,\'@@\',1)\n  and c.timeEpochMillisUTC between b.timeEpochMillisUTC and b.timeEpochMillisUTCNextHotLead\n  LEFT OUTER JOIN\n  (\n      SELECT header.timeEpochMillisUTC\n      , header.applicationId\n      , header.associativeTag\n      , header.channelSessionId\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteId\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteType\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.response\n      from RawIDM where body.typeSpecificBody.body.OnlineInvitationResponseEvent IS NOT NULL\n  ) d on c.applicationId = d.applicationId and c.associativeTag = d.associativeTag and c.channelSessionId = d.channelSessionId\n  and c.inviteId = d.inviteId\n  LEFT OUTER JOIN\n  (\n      select min(eventRaisedTimeMillis) as eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/requested\'\n      group by\n      interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.account\n      , context.client\n  ) f on COALESCE(d.associativeTag,c.associativeTag) = f.vi and COALESCE(d.inviteId,c.inviteId) = f.psid\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/started\'\n  ) g on (f.interactionId = g.interactionId) or(COALESCE(d.associativeTag,c.associativeTag) = g.vi and COALESCE(d.inviteId,c.inviteId) = g.psid)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/interactive\'\n  ) h on (COALESCE(g.interactionId,f.interactionId) = h.interactionId)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/disposed\'\n  ) i on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = i.interactionId)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      , context.terminationReason as terminationCode\n      from AssistInteractions\n      where eventType = \'interaction/status/cancelled\'\n  ) j on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = j.interactionId)',0,1,NULL,NULL,1521793875469,1521793875469,'System','System'),('view_def_967754fa-4184-493c-855c-050211b6385b','ViewDCF_Hourly','view_f4cd503a-bda3-4445-9501-91349f9e628f','SELECT COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC,c.timeEpochMillisUTC,d.timeEpochMillisUTC,f.eventRaisedTimeMillis,g.eventRaisedTimeMillis,h.eventRaisedTimeMillis,i.eventRaisedTimeMillis,j.eventRaisedTimeMillis,UNIX_TIMESTAMP(NOW())) as startTime\n  , a.timeEpochMillisUTC as PageLoadTimeEpochMillisUTC\n  , COALESCE(b.associativeTag,a.associativeTag) as VisitorID \n  , COALESCE(b.channelSessionId,a.channelSessionId) as VisitorBrowserSessionId \n  , COALESCE(b.applicationId,a.applicationId) as ClientID \n  , a.pageURL as PageLoadURL\n  , a.pageTitle as PageTitle\n  , b.timeEpochMillisUTC as HotleadTimeEpochMillisUTC\n  , b.targetGroupId as TargetGroupID\n  , b.ruleId as RuleID\n  , c.timeEpochMillisUTC as InviteShownTimeEpochMillisUTC\n  , c.inviteId as InviteID\n  , c.inviteType as InviteType\n  , d.timeEpochMillisUTC as InviteResponseTimeEpochMillisUTC\n  , d.response as InviteResponseID\n  , d.timeEpochMillisUTC as PCFTimeEpochMillisUTC\n  , f.eventRaisedTimeMillis as ChatRequestTimeEpochMillisUTC\n  , f.interactionId as InteractionID\n  , g.eventRaisedTimeMillis as ChatStartedTimeEpochMillisUTC\n  , h.eventRaisedTimeMillis as ChatInteractiveTimeEpochMillisUTC\n  , i.queue as ChatDisposedQueueID\n  , i.eventRaisedTimeMillis as ChatDisposedTimeEpochMillisUTC\n  , j.eventRaisedTimeMillis as ChatCancelledTimeEpochMillisUTC\n  , j.terminationCode as ChatCancelID\n  , j.queue as ChatCancelQueueID\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as InteractiveUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as InteractiveUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as InteractiveAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as InteractivePlatformFailure\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as ConnectedUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as ConnectedUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_NON_RESPONSIVE_AUTO_TERMINATED\') THEN 1 ELSE 0 END as ConnectedUserUnreachableAgentEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as ConnectedAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as ConnectedPlatformFailure\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as QueuedUserEnded\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as QueuedUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_FULL\') THEN 1 ELSE 0 END as QueuedQueueFull\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_TIMEOUT\') THEN 1 ELSE 0 END as QueuedQueueTimeOut\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as QueuedAgentLost\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as QueuedPlatformFailure \n  , CONCAT(COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC),\':\',COALESCE(b.channelSessionId,a.channelSessionId)) as UniqueRowId \n  FROM\n  (\n      SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextHotLead\n      FROM\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.applicationId\n          , header.associativeTag\n          , header.channelSessionId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n          from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n      ) a\n      LEFT OUTER JOIN\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.applicationId\n          , header.associativeTag\n          , header.channelSessionId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n          , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n          from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n      ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n      group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId\n  ) b \n  LEFT OUTER JOIN \n  (\n      SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextPageLoad\n      FROM\n      (\n          SELECT header.timeEpochMillisUTC\n          , header.associativeTag\n          , header.channelSessionId\n          , header.applicationId\n          , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n          , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n          , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n          , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n          FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n      ) a\n      LEFT OUTER JOIN\n      (\n      SELECT header.timeEpochMillisUTC\n      , header.associativeTag\n      , header.channelSessionId\n      , header.applicationId\n      , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n      , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n      , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n      , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n      FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n      ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n      group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL\n  \n  ) a on a.applicationId = b.applicationId and a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and b.timeEpochMillisUTC between a.timeEpochMillisUTC and COALESCE(a.timeEpochMillisUTCNextPageLoad,b.timeEpochMillisUTC)\n  LEFT OUTER JOIN\n  (\n      SELECT header.timeEpochMillisUTC\n      , header.applicationId\n      , header.associativeTag\n      , header.channelSessionId\n      , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteId\n      , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteType\n      from RawIDM where body.typeSpecificBody.body.OnlineInvitationOfferEvent IS NOT NULL\n  ) c on COALESCE(b.applicationId,a.applicationId) = c.applicationId and COALESCE(b.associativeTag,a.associativeTag) = c.associativeTag\n  and COALESCE(b.channelSessionId,a.channelSessionId) = substring_index(c.channelSessionId,\'@@\',1)\n  and c.timeEpochMillisUTC between b.timeEpochMillisUTC and b.timeEpochMillisUTCNextHotLead\n  LEFT OUTER JOIN\n  (\n      SELECT header.timeEpochMillisUTC\n      , header.applicationId\n      , header.associativeTag\n      , header.channelSessionId\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteId\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteType\n      , body.typeSpecificBody.body.OnlineInvitationResponseEvent.response\n      from RawIDM where body.typeSpecificBody.body.OnlineInvitationResponseEvent IS NOT NULL\n  ) d on c.applicationId = d.applicationId and c.associativeTag = d.associativeTag and c.channelSessionId = d.channelSessionId\n  and c.inviteId = d.inviteId\n  LEFT OUTER JOIN\n  (\n      select min(eventRaisedTimeMillis) as eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/requested\'\n      group by\n      interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.account\n      , context.client\n  ) f on COALESCE(d.associativeTag,c.associativeTag) = f.vi and COALESCE(d.inviteId,c.inviteId) = f.psid\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/started\'\n  ) g on (f.interactionId = g.interactionId) or(COALESCE(d.associativeTag,c.associativeTag) = g.vi and COALESCE(d.inviteId,c.inviteId) = g.psid)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/interactive\'\n  ) h on (COALESCE(g.interactionId,f.interactionId) = h.interactionId)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      from AssistInteractions\n      where eventType = \'interaction/status/disposed\'\n  ) i on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = i.interactionId)\n  LEFT OUTER JOIN\n  (\n      select eventRaisedTimeMillis\n      , interactionId\n      , context.data.vi\n      , context.data.psid\n      , context.data.queue\n      , context.data.queueTransferCount\n      , context.account\n      , context.client\n      , context.terminationReason as terminationCode\n      from AssistInteractions\n      where eventType = \'interaction/status/cancelled\'\n  ) j on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = j.interactionId)',0,1,NULL,NULL,1521793652604,1521793652604,'System','System'),('view_sql_def_1513077425','IDM1','viewinfo_1513089700','',1,0,'','',1522758186000,1522758186000,'Emil','Emil'),('view_sql_def_1513077426','IDM','viewinfo_1513089727','',1,0,'','',1513077426,1513077426,'Manual','Manual'),('view_sql_def_1513077427','SpeechPlatformCallStartEvent','viewinfo_1513089728','SELECT header.* ,body.typeSpecificBody.body.SpeechPlatformCallStartEvent.* from RawIDM where body.typeSpecificBody.body.SpeechPlatformCallStartEvent IS NOT NULL',1,0,'','',1513077427,1513077427,'Manual','Manual'),('view_sql_def_1513077428','Treatment','viewinfo_1513089730','SELECT header.*,body.typeSpecificBody.body.WebPageLoadEvent.* from RawIDM where body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL',1,0,'','',1513077428,1513077428,'Manual','Manual'),('view_sql_def_1513077429','WebPageLoadEvent','viewinfo_1513089731','SELECT header.*,body.typeSpecificBody.body.WebPageLoadEvent.* from RawIDM where body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL',1,0,'','',1513077429,1513077429,'Manual','Manual'),('view_sql_def_1513077430','WebSessionStartEvent','viewinfo_1513089729','SELECT header.* ,body.typeSpecificBody.body.WebSessionStartEvent.* from RawIDM where body.typeSpecificBody.body.WebSessionStartEvent IS NOT NULL',1,0,'','',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077431','View1_SpeechPlatform_WebSessionStartEvent','','SELECT header.clientId as clientId, header.channelSessionId AS channelSessionId,header.channel AS channeltype,header.timeEpochMillisUTC AS startTime \nFROM RawIDM WHERE (body.typeSpecificBody.body.SpeechPlatformCallStartEvent IS NOT NULL) OR (body.typeSpecificBody.body.WebSessionStartEvent IS NOT NULL)',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077432','View2_Treatment','','SELECT header.clientId as clientId, from_unixtime(header.timeEpochMillisUTC/1000,\'YYYY-MM-dd HH:mm:ss\') AS resolutionTime,header.channelSessionId AS channelSessionId,header.channel AS channeltype,body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName AS intentName,body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId AS userId,body.typeSpecificBody.body.Treatment.reportDimensions.attributes.billType AS billType,body.typeSpecificBody.body.Treatment.treatmentCategory AS treatmentCategory FROM RawIDM WHERE body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName IS NOT NULL',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077433','View21_Treatment','','SELECT clientId as clientId1, userid as userid1 ,min(resolutiontime) as resolutiontime1 FROM View2_Treatment group by userid , clientId',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077434','View211_Treatment','','SELECT * FROM View2_Treatment LEFT JOIN View21_Treatment ON View2_Treatment.userid = View21_Treatment.userid1 AND View2_Treatment.clientId = View21_Treatment.clientId1  WHERE (View2_Treatment.resolutiontime - View21_Treatment.resolutiontime1) < 3600000',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077435','View1_211','','SELECT t1.clientId,\r t1.startTime,\r t1.channelSessionId,\r t1.channeltype,\r t2.userId,\r t2.intentName,\r t2.resolutionTime,\r t2.treatmentCategory,\r t2.billType\r FROM View1_SpeechPlatform_WebSessionStartEvent t1, View211_Treatment t2\r WHERE t1.channelSessionId = t2.channelSessionId\r AND t1.clientId = t2.clientId',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077436','AivaResolution','','SELECT clientId AS AivaResolution_ClientId \n,resolutionTime as AivaResolution_resolutionTime,\nintentName AS AivaResolution_intentName,\nbillType AS intentName_billType,\ntreatmentCategory AS AivaResolution_Escalated,\nchannelSessionId AS AivaResolution_channelSessionId,\nchanneltype AS AivaResolution_channeltype,\nuserId as AivaResolution_userId,\nstartTime AS AivaResolution_startTime\nFROM View1_211',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077437','DQ_RawIDM','','  SELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'RawIDM\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'trackingId\' AS Column,\'IS NULL\' AS RulllName FROM RawIDM WHERE  (body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId) IS NULL',1,0,' ',' ',1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077448','ViewSW',NULL,' SELECT \n header.timeEpochMillisUTC AS ViewSW_startTime,\n header.timeEpochMillisUTC AS ViewSW_resolutionTime,\n header.applicationId AS ViewSW_userId, \n body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName AS ViewSW_intentName,\n body.typeSpecificBody.body.Treatment.reportDimensions.attributes.billType AS ViewSW_billType,\n header.useInEvaluation AS ViewSW_Escalated,\n header.environment AS ViewSW_Reverted,\n body.typeSpecificBody.body.Treatment.treatmentCategory AS ViewSW_treatmentCategory,\n header.channelSessionId AS ViewSW_channelSessionId,\n body.typeSpecificBody.body.OnlineInvitationOfferEvent.targetChannelType AS ViewSW_channeltype,\n header.associativeTag AS ViewSW_uniqueId,\n header.timeEpochMillisUTC As ViewSW_epoch\n FROM RawIDM \n WHERE (body.typeSpecificBody.body.SpeechPlatformCallStartEvent IS NOT NULL) OR (body.typeSpecificBody.body.WebSessionStartEvent IS NOT NULL)',1,0,NULL,NULL,1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077449','DQ_View_Billing',NULL,'SELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'Treatment\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName\' AS Column,\'IS NULL\' AS RulllName \nFROM RawIDM  \nwhere (body.typeSpecificBody.body.Treatment) IS NOT NULL \nAND body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName IS NULL\nUNION ALL\nSELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'Treatment\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'body.typeSpecificBody.body.Treatment.treatmentCategory\' AS Column,\'NOT Like SELF_SERVICE and DEFLECT\' AS RulllName \nFROM RawIDM \nwhere (body.typeSpecificBody.body.Treatment) IS NOT NULL \nAND (body.typeSpecificBody.body.Treatment.treatmentCategory) not in (\'SELF_SERVICE\',\'DEFLECT\')\nUNION ALL\nSELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'Treatment\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId\' AS Column,\'IS NULL\' AS RulllName \nFROM RawIDM  \nwhere (body.typeSpecificBody.body.Treatment) IS NOT NULL \nAND (body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId) IS NULL\nUNION ALL\nSELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'Intent\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'body.typeSpecificBody.body.Intent.reportDimensions.attributes.intentName\' AS Column,\'IS NULL\' AS RulllName \nFROM RawIDM  \nwhere (body.typeSpecificBody.body.Intent) IS NOT NULL\nAND body.typeSpecificBody.body.Intent.reportDimensions.attributes.intentName IS NULL\nUNION ALL\nSELECT concat(header.timeEpochMillisUTC,header.clientId,header.channelSessionId) as uniqueId,current_timestamp() AS SysTime,\'Intent\' AS ViewName,header.timeEpochMillisUTC as EpochMillisUTC,header.clientId as ClientId,\'body.typeSpecificBody.body.Intent.reportDimensions.attributes.trackingId\' AS Column,\'IS NULL\' AS RulllName \nFROM RawIDM  \nwhere (body.typeSpecificBody.body.Intent) IS NOT NULL\nAND body.typeSpecificBody.body.Intent.reportDimensions.attributes.trackingId IS NULL',1,0,NULL,NULL,1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077450','dummy_e2e','viewinfo_1513089760','SELECT header.timeEpochMillisUTC AS dummy_e2e_uniqueId,header.applicationId AS dummy_e2e_ViewDummy_userId,header.channelSessionId AS dummy_e2e_ViewDummy_channelSessionId FROM RawIDM WHERE(body.typeSpecificBody.body.SpeechPlatformCallStartEvent IS NOT NULL) OR (body.typeSpecificBody.body.WebSessionStartEvent IS NOT NULL)',1,0,NULL,NULL,1513077430,1513077430,'Manual','Manual'),('view_sql_def_1513077500','ViewDCF','viewinfo_1513090000','SELECT COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC,c.timeEpochMillisUTC,d.timeEpochMillisUTC,f.eventRaisedTimeMillis,g.eventRaisedTimeMillis,h.eventRaisedTimeMillis,i.eventRaisedTimeMillis,j.eventRaisedTimeMillis,UNIX_TIMESTAMP(NOW())) as startTime\n   , a.timeEpochMillisUTC as PageLoadTimeEpochMillisUTC\n   , COALESCE(b.associativeTag,a.associativeTag) as VisitorID \n   , COALESCE(b.channelSessionId,a.channelSessionId) as VisitorBrowserSessionId \n   , COALESCE(b.applicationId,a.applicationId) as ClientID \n   , a.pageURL as PageLoadURL\n   , a.pageTitle as PageTitle\n   , b.timeEpochMillisUTC as HotleadTimeEpochMillisUTC\n   , b.targetGroupId as TargetGroupID\n   , b.ruleId as RuleID\n   , c.timeEpochMillisUTC as InviteShownTimeEpochMillisUTC\n   , c.inviteId as InviteID\n   , c.inviteType as InviteType\n   , d.timeEpochMillisUTC as InviteResponseTimeEpochMillisUTC\n   , d.response as InviteResponseID\n   , d.timeEpochMillisUTC as PCFTimeEpochMillisUTC\n   , f.eventRaisedTimeMillis as ChatRequestTimeEpochMillisUTC\n   , f.interactionId as InteractionID\n   , g.eventRaisedTimeMillis as ChatStartedTimeEpochMillisUTC\n   , h.eventRaisedTimeMillis as ChatInteractiveTimeEpochMillisUTC\n   , i.queue as ChatDisposedQueueID\n   , i.eventRaisedTimeMillis as ChatDisposedTimeEpochMillisUTC\n   , j.eventRaisedTimeMillis as ChatCancelledTimeEpochMillisUTC\n   , j.terminationCode as ChatCancelID\n   , j.queue as ChatCancelQueueID\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as InteractiveUserEnded\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as InteractiveUserUnavailable\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as InteractiveAgentLost\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as InteractivePlatformFailure\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as ConnectedUserEnded\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as ConnectedUserUnavailable\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND j.terminationCode = \'VISITOR_NON_RESPONSIVE_AUTO_TERMINATED\') THEN 1 ELSE 0 END as ConnectedUserUnreachableAgentEnded\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as ConnectedAgentLost\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as ConnectedPlatformFailure\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as QueuedUserEnded\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as QueuedUserUnavailable\n  , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_FULL\') THEN 1 ELSE 0 END as QueuedQueueFull\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND j.terminationCode = \'QUEUE_TIMEOUT\') THEN 1 ELSE 0 END as QueuedQueueTimeOut\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'OWNER_UNREACHABLE\' OR j.terminationCode = \'OWNER_ABRUPT_LOGOUT\' OR j.terminationCode = \'OWNER_TIMEDOUT\' OR j.terminationCode = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as QueuedAgentLost\n   , CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (j.terminationCode = \'ALLOCATION_TIMEOUT\' OR j.terminationCode = \'ALLOCATION_FAILURE\' OR j.terminationCode = \'VISITOR_INVITE_REJECTED\' OR j.terminationCode = \'VISITOR_INVITE_FAILURE\' OR j.terminationCode = \'VISITOR_COLLAB_FAILURE\' OR j.terminationCode = \'OWNER_INVITE_FAILURE\' OR j.terminationCode = \'OWNER_COLLAB_FAILURE\' OR j.terminationCode = \'ADDRESS_BOOK_FAILURE\' OR j.terminationCode = \'COLLABORATION_SERVER_FAILURE\' OR j.terminationCode = \'INTERACTION_STATE_ERROR\' OR j.terminationCode = \'INTERACTION_LIFECYCLE_ERROR\' OR j.terminationCode = \'CACHE_FAILURE\' OR j.terminationCode = \'SYSTEM_FAILURE\' OR j.terminationCode = \'UNCLASSIFIED_FAILURE\' OR j.terminationCode = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as QueuedPlatformFailure \n   , CONCAT(COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC),\':\',COALESCE(b.channelSessionId,a.channelSessionId)) as UniqueRowId \n   FROM\n   (\n       SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextHotLead\n       FROM\n       (\n           SELECT header.timeEpochMillisUTC\n           , header.applicationId\n           , header.associativeTag\n           , header.channelSessionId\n           , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n           , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n           from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n       ) a\n       LEFT OUTER JOIN\n       (\n           SELECT header.timeEpochMillisUTC\n           , header.applicationId\n           , header.associativeTag\n           , header.channelSessionId\n           , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n           , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId\n           from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL\n       ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n       group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId\n   ) b \n   LEFT OUTER JOIN \n   (\n       SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextPageLoad\n       FROM\n       (\n           SELECT header.timeEpochMillisUTC\n           , header.associativeTag\n           , header.channelSessionId\n           , header.applicationId\n           , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n           , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n           , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n           , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n           FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n       ) a\n       LEFT OUTER JOIN\n       (\n       SELECT header.timeEpochMillisUTC\n       , header.associativeTag\n       , header.channelSessionId\n       , header.applicationId\n       , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n       , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n       , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath\n       , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL\n       FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n       ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC\n       group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL\n   \n   ) a on a.applicationId = b.applicationId and a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and b.timeEpochMillisUTC between a.timeEpochMillisUTC and COALESCE(a.timeEpochMillisUTCNextPageLoad,b.timeEpochMillisUTC)\n   LEFT OUTER JOIN\n   (\n       SELECT header.timeEpochMillisUTC\n       , header.applicationId\n       , header.associativeTag\n       , header.channelSessionId\n       , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteId\n       , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteType\n       from RawIDM where body.typeSpecificBody.body.OnlineInvitationOfferEvent IS NOT NULL\n   ) c on COALESCE(b.applicationId,a.applicationId) = c.applicationId and COALESCE(b.associativeTag,a.associativeTag) = c.associativeTag\n   and COALESCE(b.channelSessionId,a.channelSessionId) = substring_index(c.channelSessionId,\'@@\',1)\n   and c.timeEpochMillisUTC between b.timeEpochMillisUTC and b.timeEpochMillisUTCNextHotLead\n   LEFT OUTER JOIN\n   (\n       SELECT header.timeEpochMillisUTC\n       , header.applicationId\n       , header.associativeTag\n       , header.channelSessionId\n       , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteId\n       , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteType\n       , body.typeSpecificBody.body.OnlineInvitationResponseEvent.response\n       from RawIDM where body.typeSpecificBody.body.OnlineInvitationResponseEvent IS NOT NULL\n   ) d on c.applicationId = d.applicationId and c.associativeTag = d.associativeTag and c.channelSessionId = d.channelSessionId\n   and c.inviteId = d.inviteId\n   LEFT OUTER JOIN\n   (\n       select min(eventRaisedTimeMillis) as eventRaisedTimeMillis\n       , interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.account\n       , context.client\n       from AssistInteractions\n       where eventType = \'interaction/status/requested\'\n       group by\n       interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.account\n       , context.client\n   ) f on COALESCE(d.associativeTag,c.associativeTag) = f.vi and COALESCE(d.inviteId,c.inviteId) = f.psid\n   LEFT OUTER JOIN\n   (\n       select eventRaisedTimeMillis\n       , interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.data.queue\n       , context.data.queueTransferCount\n       , context.account\n       , context.client\n       from AssistInteractions\n       where eventType = \'interaction/status/started\'\n   ) g on (f.interactionId = g.interactionId) or(COALESCE(d.associativeTag,c.associativeTag) = g.vi and COALESCE(d.inviteId,c.inviteId) = g.psid)\n   LEFT OUTER JOIN\n   (\n       select eventRaisedTimeMillis\n       , interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.data.queue\n       , context.data.queueTransferCount\n       , context.account\n       , context.client\n       from AssistInteractions\n       where eventType = \'interaction/status/interactive\'\n   ) h on (COALESCE(g.interactionId,f.interactionId) = h.interactionId)\n   LEFT OUTER JOIN\n   (\n       select eventRaisedTimeMillis\n       , interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.data.queue\n       , context.data.queueTransferCount\n       , context.account\n       , context.client\n       from AssistInteractions\n       where eventType = \'interaction/status/disposed\'\n   ) i on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = i.interactionId)\n   LEFT OUTER JOIN\n   (\n       select eventRaisedTimeMillis\n       , interactionId\n       , context.data.vi\n       , context.data.psid\n       , context.data.queue\n       , context.data.queueTransferCount\n       , context.account\n       , context.client\n       , context.terminationReason as terminationCode\n       from AssistInteractions\n       where eventType = \'interaction/status/cancelled\'\n   ) j on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = j.interactionId)',1,1,NULL,NULL,1517564671,1517564671,'Emil','Emil'),('view_sql_def_1513077501','AssistInteractions','viewinfo_1513070000','',1,0,'','',1517819333,1517819333,'Emil','Emil'),('view_sql_def_1513080000','OnlinePreChatSubmitEvent',NULL,'select header.* ,header.timeEpochMillisUTC as timeEpochMillisUTC, body.typeSpecificBody.body.OnlinePreChatSubmitEvent.*  from   RawIDM  where body.typeSpecificBody.body.OnlinePreChatSubmitEvent is not null',1,1,NULL,NULL,1517569912,1517569912,'Emil','Emil'),('view_sql_def_1514000000','TreatmentBase',NULL,'SELECT header.* , body.typeSpecificBody.body.Treatment.treatmentCategory as treatmentCategory, body.typeSpecificBody.body.Treatment.treatmentName as treatmentName, body.typeSpecificBody.body.Treatment.reportDimensions.journeyType as journeyType, body.typeSpecificBody.body.Treatment.reportDimensions.isAuthenticated as isAuthenticated, body.typeSpecificBody.body.Treatment.reportDimensions.attributes.billType as billType, body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName as intentName, body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId as trackingId from RawIDM where body.typeSpecificBody.body.Treatment IS NOT NULL AND body.typeSpecificBody.body.Treatment.treatmentCategory = \'SELF_SERVICE\' AND body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId IS NOT NULL',1,1,NULL,NULL,1518492710,1518492710,'Emil','Emil'),('view_sql_def_1514000001','TreatmentDeflect',NULL,'SELECT header.* , body.typeSpecificBody.body.Treatment.treatmentCategory as treatmentCategory, body.typeSpecificBody.body.Treatment.treatmentName as treatmentName, body.typeSpecificBody.body.Treatment.deflection.deflectionType as deflectionType, body.typeSpecificBody.body.Treatment.deflection.origChannel as origChannel, body.typeSpecificBody.body.Treatment.deflection.targetChannel as targetChannel, body.typeSpecificBody.body.Treatment.reportDimensions.journeyType as journeyType, body.typeSpecificBody.body.Treatment.reportDimensions.isAuthenticated as isAuthenticated, body.typeSpecificBody.body.Treatment.reportDimensions.attributes.intentName as intentName, body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId as trackingId from RawIDM where body.typeSpecificBody.body.Treatment IS NOT NULL AND body.typeSpecificBody.body.Treatment.treatmentCategory = \'DEFLECT\' AND body.typeSpecificBody.body.Treatment.reportDimensions.attributes.trackingId IS NOT NULL',1,1,NULL,NULL,1518492724,1518492724,'Emil','Emil'),('view_sql_def_1514000002','Intent',NULL,'SELECT header.* , body.typeSpecificBody.body.Intent.intentCategory as intentCategory, body.typeSpecificBody.body.Intent.intentName as intentName, body.typeSpecificBody.body.Intent.intentModel as intentModel, body.typeSpecificBody.body.Intent.reportDimensions.attributes.intentName as repAttIntentName, body.typeSpecificBody.body.Intent.reportDimensions.attributes.trackingId as repAttTrackingId, body.typeSpecificBody.body.Intent.reportDimensions.attributes.nodeName as repAttNodeName, body.typeSpecificBody.body.Intent.reportDimensions.attributes.modelName as repAttModelName FROM RawIDM1 WHERE body.typeSpecificBody.body.Intent IS NOT NULL',1,1,NULL,NULL,1518492731,1518492731,'Emil','Emil'),('view_sql_def_1514000003','View_Billing',NULL,'SELECT \n COALESCE(d.timeEpochMillisUTC,a.timeEpochMillisUTC) as CallStartTime \n , a.trackingId as TrackingId \n , a.intentName as IntentName \n , CASE WHEN COALESCE(MIN(b.timeEpochMillisUTC),1) > 1 THEN \'Y\' ELSE \'N\' END as Escalated \n , CASE WHEN COALESCE(MIN(c.timeEpochMillisUTC),1) > 1 THEN \'Y\' ELSE \'N\' END as Reverted \n , CASE WHEN COALESCE(MIN(b.timeEpochMillisUTC),1) = 1 AND COALESCE(MIN(c.timeEpochMillisUTC),1) = 1 THEN \'Y\' ELSE \'N\' END as Billable  \n , CONCAT(COALESCE(d.timeEpochMillisUTC,a.timeEpochMillisUTC),\':\',a.trackingId,\':\',a.intentName) as UniqueRowId\n FROM \n TreatmentBase a \n LEFT OUTER JOIN \n TreatmentDeflect b ON a.clientId = b.clientId and a.channelSessionId = b.channelSessionId and a.timeEpochMillisUTC < b.timeEpochMillisUTC \n LEFT OUTER JOIN \n Intent c ON a.clientId = c.clientId and a.trackingId = c.repAttTrackingId and a.intentName = c.repAttIntentName and c.timeEpochMillisUTC between a.timeEpochMillisUTC and (a.timeEpochMillisUTC+(24*3600*1000)) \n LEFT OUTER JOIN \n SpeechPlatformCallStartEvent d ON a.clientId = d.clientId and a.channelSessionId = d.channelSessionId and a.timeEpochMillisUTC > d.timeEpochMillisUTC\n GROUP BY \n a.timeEpochMillisUTC\n , a.trackingId\n , a.intentName \n , d.timeEpochMillisUTC',1,1,NULL,NULL,1518495426,1518495426,'Emil','Emil'),('view_sql_def_1514090000','DQ_View_DCF_old','viewinfo_1514090000','select UniqueRowId as uniqueId,current_timestamp() AS SysTime,\'View_DCF_old\' AS ViewName,startTime as EpochMillisUTC,ClientID as ClientId,\'ChatRequestTimeEpochMillisUTC\' AS Column,\'IS NULL where StartTime and InteractiveTime is avalable\' AS RulllName  \n from View_DCF_old where ChatRequestTimeEpochMillisUTC IS NULL \n and (ChatStartedTimeEpochMillisUTC is not null or ChatInteractiveTimeEpochMillisUTC is not null)\n UNION ALL\n select UniqueRowId as uniqueId,current_timestamp() AS SysTime,\'View_DCF_old\' AS ViewName,startTime as EpochMillisUTC,ClientID as ClientId,\'ChatStartedTimeEpochMillisUTC\' AS Column,\'IS NULL where RequestTime and InteractiveTime is avalable\' AS RulllName  \n from View_DCF_old where ChatStartedTimeEpochMillisUTC IS NULL \n and (ChatRequestTimeEpochMillisUTC is not null or ChatInteractiveTimeEpochMillisUTC is not null)',1,1,NULL,NULL,1518495426,1518495426,'Emil','Emil'),('view_sql_def_1515000000','View_DCF','viewinfo_1515000000','SELECT CONCAT(COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC),\':\',COALESCE(b.channelSessionId,a.channelSessionId)) as uniqueRowId \n, COALESCE(a.timeEpochMillisUTC,b.timeEpochMillisUTC) as journeyStartTime\n, a.timeEpochMillisUTC as pageLoadTimeEpochMillisUTC\n, COALESCE(b.associativeTag,a.associativeTag) as visitorID \n, COALESCE(b.channelSessionId,a.channelSessionId) as visitorBrowserSessionId \n, COALESCE(b.applicationId,a.applicationId) as clientID  \n, a.pageURL as pageLoadURL \n, a.pageTitle as pageTitle \n, b.timeEpochMillisUTC as hotleadTimeEpochMillisUTC \n, b.evalType as hotLeadEvalType \n, b.evalFailureReason as hotLeadEvalFailureReason \n, b.targetGroupId as targetGroupID \n, b.ruleId as ruleID \n, CASE WHEN COALESCE(c.timeEpochMillisUTC,0) = 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%queueafterhours%\' THEN 1 ELSE 0 END AS queueAfterHoursPriorInviteFlag \n, CASE WHEN COALESCE(c.timeEpochMillisUTC,0) = 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%cacheckfail%\' THEN 1 ELSE 0 END AS caCheckFailPriorInviteFlag \n, c.timeEpochMillisUTC as inviteShownTimeEpochMillisUTC \n, c.inviteId as inviteID\n, c.inviteType as inviteType\n, d.timeEpochMillisUTC as inviteResponseTimeEpochMillisUTC\n, d.response as inviteResponseID \n, CASE WHEN COALESCE(d.timeEpochMillisUTC,0) > 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%queueafterhours%\' THEN 1 ELSE 0 END AS queueAfterHoursPostInviteResponseFlag \n, CASE WHEN COALESCE(d.timeEpochMillisUTC,0) > 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%cacheckfail%\' THEN 1 ELSE 0 END AS caCheckFailPostInviteResponseFlag \n, k.timeEpochMillisUTC as pcfShownTimeEpochMillisUTC \n, e.timeEpochMillisUTC as pcfSubmitTimeEpochMillisUTC \n, CASE WHEN COALESCE(e.timeEpochMillisUTC,0) > 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%queueafterhours%\' THEN 1 ELSE 0 END AS queueAfterHoursPostPCFSubmitFlag \n, CASE WHEN COALESCE(e.timeEpochMillisUTC,0) > 0 AND COALESCE(f.eventRaisedTimeMillis,0) = 0 AND LOWER(l.appInfo) like \'%cacheckfail%\' THEN 1 ELSE 0 END AS caCheckFailPostPCFSubmitFlag \n, f.eventRaisedTimeMillis as chatRequestTimeEpochMillisUTC \n, f.interactionId as interactionID \n, g.eventRaisedTimeMillis as chatStartedTimeEpochMillisUTC\n, h.eventRaisedTimeMillis as chatInteractiveTimeEpochMillisUTC \n, i.queue as chatDisposedQueueID \n, i.eventRaisedTimeMillis as chatDisposedTimeEpochMillisUTC \n, j.eventRaisedTimeMillis as chatCancelledTimeEpochMillisUTC \n, COALESCE(COALESCE(j.terminationCode,n.terminationCode),n.terminationCode) as chatCancelID \n, j.queue as chatCancelQueueID \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as preQueuedUserEndedFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as preQueuedUserUnavailableFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'QUEUE_FULL\') THEN 1 ELSE 0 END as preQueuedQueueFullFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_UNREACHABLE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_ABRUPT_LOGOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_TIMEDOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as preQueuedAgentLostFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) = 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_TIMEOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_REJECTED\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ADDRESS_BOOK_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'COLLABORATION_SERVER_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_STATE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_LIFECYCLE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'CACHE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'SYSTEM_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'UNCLASSIFIED_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as preQueuedPlatformFailureFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as preConnectedUserEndedFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as preConnectedUserUnavailableFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_NON_RESPONSIVE_AUTO_TERMINATED\') THEN 1 ELSE 0 END as preConnectedUserUnreachableAgentEndedFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_UNREACHABLE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_ABRUPT_LOGOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_TIMEDOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as preConnectedAgentLostFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_TIMEOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_REJECTED\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ADDRESS_BOOK_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'COLLABORATION_SERVER_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_STATE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_LIFECYCLE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'CACHE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'SYSTEM_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'UNCLASSIFIED_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as preConnectedPlatformFailureFlag    \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) = 1 AND COALESCE(f.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'QUEUE_TIMEOUT\') THEN 1 ELSE 0 END as preConnectedQueueTimeOutFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as preInteractiveUserEndedFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as preInteractiveUserUnavailableFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_UNREACHABLE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_ABRUPT_LOGOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_TIMEDOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as preInteractiveAgentLostFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) = 1 AND COALESCE(g.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_TIMEOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_REJECTED\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ADDRESS_BOOK_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'COLLABORATION_SERVER_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_STATE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_LIFECYCLE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'CACHE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'SYSTEM_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'UNCLASSIFIED_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as preInteractivePlatformFailureFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_LEAVE\') THEN 1 ELSE 0 END as postInteractiveUserEndedFlag  \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_UNAVAILABLE\') THEN 1 ELSE 0 END as postInteractiveUserUnavailableFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_NON_RESPONSIVE_AUTO_TERMINATED\') THEN 1 ELSE 0 END as postInteractiveUserUnreachableAgentEndedFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_UNREACHABLE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_ABRUPT_LOGOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_TIMEDOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_LEFT\')) THEN 1 ELSE 0 END as postInteractiveAgentLostFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND (COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_TIMEOUT\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ALLOCATION_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_REJECTED\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'VISITOR_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_INVITE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'OWNER_COLLAB_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'ADDRESS_BOOK_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'COLLABORATION_SERVER_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_STATE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'INTERACTION_LIFECYCLE_ERROR\' OR COALESCE(j.terminationCode,n.terminationCode) = \'CACHE_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'SYSTEM_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'UNCLASSIFIED_FAILURE\' OR COALESCE(j.terminationCode,n.terminationCode) = \'MONITORING_RECONCILE\')) THEN 1 ELSE 0 END as postInteractivePlatformFailureFlag    \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'QUEUE_TIMEOUT\') THEN 1 ELSE 0 END as postInteractiveQueueTimeOutFlag \n, CASE WHEN (COALESCE(h.eventRaisedTimeMillis,1) > 1 AND COALESCE(j.terminationCode,n.terminationCode) = \'QUEUE_FULL\') THEN 1 ELSE 0 END as postInteractiveQueueFullFlag \n, COALESCE(i.resolved,0) as resolvedFlag \n, COALESCE(i.inScope,0) as inScopeFlag \n, CASE WHEN m.participantInteractiveStatus = \'NON_INTERACTIVE\' THEN 1 ELSE 0 END AS agentVisitorInactiveFlag \n, CASE WHEN m.participantInteractiveStatus = \'AGENT_NON_INTERACTIVE\' THEN 1 ELSE 0 END AS agentInactiveFlag \n, CASE WHEN m.participantInteractiveStatus = \'VISITOR_NON_INTERACTIVE\' THEN 1 ELSE 0 END AS visitorInactiveFlag \n, n.visitorActivityStatusAtDisconnect \n, CASE WHEN COALESCE(j.eventRaisedTimeMillis,d.timeEpochMillisUTC,0) - COALESCE(d.timeEpochMillisUTC,0) between 1 and 5000 then 1 else 0 end as accpetToCancel1to5SecFlag \n, CASE WHEN COALESCE(j.eventRaisedTimeMillis,d.timeEpochMillisUTC,0) - COALESCE(d.timeEpochMillisUTC,0) between 5001 and 10000 then 1 else 0 end as accpetToCancel6to10SecFlag \n, CASE WHEN COALESCE(j.eventRaisedTimeMillis,d.timeEpochMillisUTC,0) - COALESCE(d.timeEpochMillisUTC,0) between 10001 and 15000 then 1 else 0 end as accpetToCancel11to15SecFlag \n, CASE WHEN COALESCE(j.eventRaisedTimeMillis,d.timeEpochMillisUTC,0) - COALESCE(d.timeEpochMillisUTC,0) between 15001 and 30000 then 1 else 0 end as accpetToCancel16to30SecFlag \n, CASE WHEN COALESCE(j.eventRaisedTimeMillis,d.timeEpochMillisUTC,0) - COALESCE(d.timeEpochMillisUTC,0) > 30000 then 1 else 0 end as accpetToCancelMoreThan30SecFlag \nFROM \n(\n    SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextHotLead, a.evalType, a.evalFailureReason, a.clientId    \n    FROM \n    (\n        SELECT header.timeEpochMillisUTC\n        , header.applicationId\n        , header.associativeTag\n        , header.channelSessionId \n        , header.clientId \n        , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n        , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId \n        , body.typeSpecificBody.body.EvalConditionCheck.evalType\n        , body.typeSpecificBody.body.EvalConditionCheck.evalFailureReason\n        from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL OR body.typeSpecificBody.body.EvalConditionCheck IS NOT NULL \n    ) a \n    LEFT OUTER JOIN \n    (\n        SELECT header.timeEpochMillisUTC\n        , header.applicationId\n        , header.associativeTag\n        , header.channelSessionId\n        , body.typeSpecificBody.body.TargetDeterminationEvent.targetGroupId\n        , body.typeSpecificBody.body.TargetDeterminationEvent.ruleId \n        from RawIDM where body.typeSpecificBody.body.TargetDeterminationEvent IS NOT NULL OR body.typeSpecificBody.body.EvalConditionCheck IS NOT NULL \n    ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC \n    group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.targetGroupId, a.ruleId, a.evalType, a.evalFailureReason, a.clientId   \n) b \nLEFT OUTER JOIN \n(\n    SELECT a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL, min(b.timeEpochMillisUTC) as timeEpochMillisUTCNextPageLoad, a.clientId \n    FROM \n    (\n        SELECT header.timeEpochMillisUTC\n        , header.associativeTag \n        , header.channelSessionId \n        , header.applicationId \n        , header.clientId \n        , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n        , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n        , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath \n        , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL \n        FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n    ) a \n    LEFT OUTER JOIN \n    (    \n        SELECT header.timeEpochMillisUTC\n        , header.associativeTag \n        , header.channelSessionId \n        , header.applicationId \n        , body.typeSpecificBody.body.WebPageLoadEvent.pageURL\n        , body.typeSpecificBody.body.WebPageLoadEvent.pageTitle\n        , body.typeSpecificBody.body.WebPageLoadEvent.navigationPath \n        , body.typeSpecificBody.body.WebPageLoadEvent.referrerURL \n        FROM RawIDM WHERE body.typeSpecificBody.body.WebPageLoadEvent IS NOT NULL\n    ) b on a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and a.applicationId = b.applicationId and a.timeEpochMillisUTC < b.timeEpochMillisUTC \n    group by a.timeEpochMillisUTC, a.associativeTag, a.channelSessionId, a.applicationId, a.pageURL, a.pageTitle, a.navigationPath, a.referrerURL, a.clientId  \n) a on a.applicationId = b.applicationId and a.associativeTag = b.associativeTag and a.channelSessionId = b.channelSessionId and b.timeEpochMillisUTC between a.timeEpochMillisUTC and COALESCE(a.timeEpochMillisUTCNextPageLoad,b.timeEpochMillisUTC) \nLEFT OUTER JOIN \n(\n    SELECT header.timeEpochMillisUTC  \n    , header.applicationId\n    , header.associativeTag\n    , header.channelSessionId \n    , header.clientId \n    , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteId\n    , body.typeSpecificBody.body.OnlineInvitationOfferEvent.inviteType  \n    from RawIDM where body.typeSpecificBody.body.OnlineInvitationOfferEvent IS NOT NULL \n) c on COALESCE(b.applicationId,a.applicationId) = c.applicationId and COALESCE(b.associativeTag,a.associativeTag) = c.associativeTag \nand COALESCE(b.channelSessionId,a.channelSessionId) = substring_index(c.channelSessionId,\'@@\',1) \nand c.timeEpochMillisUTC between b.timeEpochMillisUTC and b.timeEpochMillisUTCNextHotLead\nLEFT OUTER JOIN \n(\n    SELECT MAX(header.timeEpochMillisUTC) as timeEpochMillisUTC \n    , header.applicationId\n    , header.associativeTag\n    , header.channelSessionId \n    , header.clientId \n    , body.typeSpecificBody.body.Application.appEntity\n    , body.typeSpecificBody.body.Application.appAction\n    , body.typeSpecificBody.body.Application.appInfo\n    from RawIDM where body.typeSpecificBody.body.Application IS NOT NULL AND UPPER(header.channel) = \'OMNICHANNEL\' AND UPPER(header.source) = \'UDE\' AND UPPER(header.platform) = \'UDE\' AND (body.typeSpecificBody.body.Application.appInfo like \'%queueAfterHours%\' OR body.typeSpecificBody.body.Application.appInfo like \'%caCheckFail%\') \n    GROUP BY \n    header.applicationId\n    , header.associativeTag\n    , header.channelSessionId \n    , header.clientId \n    , body.typeSpecificBody.body.Application.appEntity\n    , body.typeSpecificBody.body.Application.appAction\n    , body.typeSpecificBody.body.Application.appInfo \n) l on COALESCE(b.applicationId,a.applicationId) = l.applicationId and COALESCE(b.associativeTag,a.associativeTag) = l.associativeTag \nand COALESCE(b.channelSessionId,a.channelSessionId) = substring_index(l.channelSessionId,\'@@\',1) \nLEFT OUTER JOIN \n(\n    SELECT header.timeEpochMillisUTC  \n    , header.applicationId\n    , header.associativeTag\n    , header.channelSessionId \n    , header.clientId \n    , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteId\n    , body.typeSpecificBody.body.OnlineInvitationResponseEvent.inviteType  \n    , body.typeSpecificBody.body.OnlineInvitationResponseEvent.response \n    from RawIDM where body.typeSpecificBody.body.OnlineInvitationResponseEvent IS NOT NULL \n) d on c.applicationId = d.applicationId and c.associativeTag = d.associativeTag and c.channelSessionId = d.channelSessionId \nand c.inviteId = d.inviteId \nLEFT OUTER JOIN \n(\n    SELECT header.timeEpochMillisUTC  \n    , header.applicationId\n    , header.associativeTag\n    , header.channelSessionId \n    , header.clientId \n    , body.typeSpecificBody.body.OnlineSurveySubmitEvent.questionsAndAnswers\n    from RawIDM where body.typeSpecificBody.body.OnlineSurveySubmitEvent IS NOT NULL AND UPPER(body.typeSpecificBody.body.OnlineSurveySubmitEvent.surveyId) = \'PCF\' \n) e on d.applicationId = e.applicationId and d.associativeTag = e.associativeTag and d.channelSessionId = e.channelSessionId \nLEFT OUTER JOIN \n(\n    SELECT max(header.timeEpochMillisUTC) as timeEpochMillisUTC   \n    , header.applicationId\n    , header.associativeTag\n    , header.channelSessionId\n    , body.typeSpecificBody.body.OnlineScreenLoadEvent.screenId\n    , body.typeSpecificBody.body.OnlineScreenLoadEvent.screenTitle  \n    from RawIDM where body.typeSpecificBody.body.OnlineScreenLoadEvent IS NOT NULL AND UPPER(body.typeSpecificBody.body.OnlineScreenLoadEvent.screenType) = \'PRECHAT\' \n    group by header.applicationId\n    , header.associativeTag\n    , header.channelSessionId\n    , body.typeSpecificBody.body.OnlineScreenLoadEvent.screenId\n    , body.typeSpecificBody.body.OnlineScreenLoadEvent.screenTitle\n) k on COALESCE(d.applicationId,c.applicationId) = k.applicationId and COALESCE(d.associativeTag,c.associativeTag) = k.associativeTag and COALESCE(d.channelSessionId,c.channelSessionId) = k.channelSessionId \nLEFT OUTER JOIN \n(\n    select min(eventRaisedTimeMillis) as eventRaisedTimeMillis \n    , interactionId\n    , context.data.vi\n    , context.data.psid\n    , context.account\n    , context.client  \n    from AssistInteractions \n    where eventType = \'interaction/status/requested\' \n    group by \n    interactionId\n    , context.data.vi\n    , context.data.psid\n    , context.account\n    , context.client \n) f on COALESCE(d.associativeTag,c.associativeTag) = f.vi and COALESCE(d.inviteId,c.inviteId) = f.psid and COALESCE(d.clientId,c.clientId) = substring_index(f.account,\'-\',1)\nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.psid\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client\n    from AssistInteractions\n    where eventType = \'interaction/status/started\'\n) g on (f.interactionId = g.interactionId) and f.account = g.account \nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client  \n    from AssistInteractions \n    where eventType = \'interaction/status/interactive\'  \n) h on (COALESCE(g.interactionId,f.interactionId) = h.interactionId) and (COALESCE(g.account,f.account) = h.account) \nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client  \n    , \'Test\' as participantInteractiveStatus  --UPPER(COALESCE(participantInteractiveStatus,\'\')) as participantInteractiveStatus --\n    from AssistInteractions \n    where eventType = \'interaction/status/noninteractive\' \n) m on (COALESCE(g.interactionId,f.interactionId) = m.interactionId) and (COALESCE(g.account,f.account) = m.account) \nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client  \n    , CASE WHEN \'YES\' = \'YES\' then 1 else 0 end as resolved --CASE WHEN UPPER(context.dispositionContext.ctx_resolution.astd) = \'YES\' then 1 else 0 end as resolved --\n    , CASE WHEN \'YES\' = \'YES\' then 1 else 0 end as inScope --CASE WHEN UPPER(context.dispositionContext.ctx_in-scope_interaction.astd) = \'YES\' then 1 else 0 end as inScope --\n    from AssistInteractions \n    where eventType = \'interaction/status/disposed\'\n) i on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = i.interactionId) \nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client \n    , UPPER(context.terminationReason) as terminationCode \n    from AssistInteractions \n    where eventType = \'interaction/status/cancelled\'\n) j on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = j.interactionId) and (COALESCE(h.account,g.account,f.account) = j.account) \nLEFT OUTER JOIN \n(\n    select eventRaisedTimeMillis\n    , interactionId\n    , context.data.vi\n    , context.data.queue\n    , context.data.queueTransferCount\n    , context.account\n    , context.client \n    , UPPER(context.terminationReason) as terminationCode \n    , \'test\' as visitorActivityStatusAtDisconnect --UPPER(context.data.VISITOR_STATUS_AT_TIME_OF_DISCONNECT) as visitorActivityStatusAtDisconnect \n    from AssistInteractions \n    where eventType = \'interaction/status/terminated\' \n) n on (COALESCE(h.interactionId,g.interactionId,f.interactionId) = n.interactionId) and (COALESCE(h.account,g.account,f.account) = n.account)',1,1,NULL,NULL,1522758186000,1522758186000,'DP2','DP2');
/*!40000 ALTER TABLE `view_sql_definition` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
